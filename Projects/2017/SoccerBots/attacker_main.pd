#N canvas 8 60 1265 628 10;
#N canvas 149 178 952 540 differential_drive 0;
#X obj 310 220 vsl 15 100 -1 1 0 0 empty empty empty 0 -9 0 10 -262144
-1 -1 7326 1;
#X obj 390 228 vsl 15 100 -1 1 0 0 empty empty empty 0 -9 0 10 -262144
-1 -1 7326 1;
#X obj 314 140 +;
#X obj 390 140 +;
#X obj 314 162 clip -1 1;
#X obj 343 110 t b f;
#X obj 403 79 * -1;
#X obj 403 110 t b f;
#X obj 390 162 clip -1 1;
#X obj 251 340 s left_speed;
#X obj 398 343 s right_speed;
#X text 169 -144 forward/ backwards;
#X text 477 -146 left/right;
#X obj 616 -130 inlet;
#X text 563 -155 steering toggle;
#X obj 190 -119 inlet~;
#X obj 690 215 hsl 128 15 10 2000 0 0 empty empty empty -2 -8 0 10
-262144 -1 -1 64 1;
#X obj 487 -124 inlet~;
#X obj 643 173 loadbang;
#X msg 648 196 20;
#X obj 490 -67 *~;
#X obj 256 -121 inlet;
#X obj 190 -67 *~;
#X obj 204 116 tgl 50 1 steering_toggle_out steering_toggle_in empty
17 7 0 10 -262144 -1 -1 1 1;
#X obj 621 -75 s steering_toggle_in;
#X obj 617 -51 r steering_toggle_out;
#X obj 243 -99 s throttle_toggle_in;
#X obj 119 120 tgl 50 1 throttle_toggle_out throttle_toggle_in empty
17 7 0 10 -262144 -1 -1 1 1;
#X obj 242 -73 r throttle_toggle_out;
#X obj 201 228 hsl 60 15 -1 1 0 0 empty steering_drive empty -2 -8
0 10 -262144 -1 -1 2950 1;
#X obj 137 205 vsl 15 60 -1 1 0 0 empty throttle_drive empty 0 -9 0
10 -262144 -1 -1 4720 1;
#X obj 190 46 s throttle_drive;
#X obj 491 48 s steering_drive;
#X floatatom 688 195 5 0 0 0 - - -, f 5;
#X obj 191 -43 lop~ 10;
#X obj 492 -44 lop~ 10;
#X obj 654 241 s sampling_period;
#X obj 254 -48 r sampling_period;
#X obj 610 -30 r sampling_period;
#X obj 194 -23 sig2num~;
#X obj 494 -20 sig2num~;
#X obj 340 191 * 0.8;
#X obj 406 195 * 0.8;
#X connect 0 0 9 0;
#X connect 1 0 10 0;
#X connect 2 0 4 0;
#X connect 3 0 8 0;
#X connect 4 0 41 0;
#X connect 5 0 2 0;
#X connect 5 1 2 1;
#X connect 6 0 7 0;
#X connect 7 0 3 0;
#X connect 7 1 3 1;
#X connect 8 0 42 0;
#X connect 13 0 24 0;
#X connect 15 0 22 0;
#X connect 16 0 33 0;
#X connect 16 0 36 0;
#X connect 17 0 20 0;
#X connect 18 0 19 0;
#X connect 19 0 16 0;
#X connect 20 0 35 0;
#X connect 21 0 26 0;
#X connect 22 0 34 0;
#X connect 25 0 20 1;
#X connect 28 0 22 1;
#X connect 34 0 39 0;
#X connect 35 0 40 0;
#X connect 37 0 39 1;
#X connect 38 0 40 1;
#X connect 39 0 31 0;
#X connect 39 0 2 0;
#X connect 39 0 3 0;
#X connect 40 0 32 0;
#X connect 40 0 6 0;
#X connect 40 0 5 0;
#X connect 41 0 0 0;
#X connect 42 0 1 0;
#X coords 0 -1 1 1 170 200 1 100 100;
#X restore 13 229 pd differential_drive;
#X obj 120 201 catch~ steering;
#N canvas 99 65 895 549 serial-connection 0;
#X obj 223 184 s motor_device;
#X text 216 68 Tell motor-control what serial device to use:;
#X obj 223 90 loadbang;
#X obj 223 112 delay 50;
#X msg 223 136 devicename /dev/serial/by-id/usb-DSpace__www.dspace.org.nz__DSpace_Robot_2.0_55234313335351503221-if00
;
#X obj 116 90 r reconnect;
#X obj 108 119 bng 15 250 50 0 empty empty Connect 17 7 0 10 -262144
-1 -1;
#X msg 128 190 close;
#X obj 108 140 bng 15 250 50 0 empty empty disconnect 17 7 0 10 -262144
-1 -1;
#X text 202 229 TODO: consider using the hostname message to set this.
Actually \, since the two robots will have different control patches
anyway \, this will work perfectly well.;
#X connect 2 0 3 0;
#X connect 3 0 4 0;
#X connect 4 0 0 0;
#X connect 5 0 6 0;
#X connect 6 0 4 0;
#X connect 7 0 0 0;
#X connect 8 0 7 0;
#X coords 0 -1 1 1 85 60 1 100 100;
#X restore 24 443 pd serial-connection;
#X obj 12 201 catch~ throttle;
#N canvas 18 74 1265 628 seek 1;
#X obj 119 105 tgl 50 0 empty empty SEEK 46 7 0 30 -262144 -1 -1 1
1;
#X obj 362 62 r ball_side;
#X obj 362 84 not;
#X obj 404 167 sig~;
#X obj 404 189 s~ seek_mode;
#X obj 114 55 r~ seek_mode;
#X obj 114 77 sig2num~;
#X text 345 19 When to activate seek mode;
#X obj 467 63 r round_mode;
#X obj 467 85 not;
#X obj 467 107 t b f;
#X obj 847 270 r ball_angle;
#X obj 563 302 expr if($f1<-27 \, -0.5 \, if($f1>27 \, 0.5 \, 0)),
f 43;
#X obj 759 447 throw~ steering;
#X obj 905 446 throw~ throttle;
#X text 835 239 Follow the ball;
#X obj 799 325 r~ seek_mode;
#X obj 759 403 *~;
#X obj 563 324 sig~;
#X obj 905 402 *~;
#X obj 905 323 sig~;
#X obj 407 139 *;
#X obj 905 301 expr if(-27<=$f1<=27 \, 0.6 \, 0);
#X connect 1 0 2 0;
#X connect 2 0 21 0;
#X connect 3 0 4 0;
#X connect 5 0 6 0;
#X connect 6 0 0 0;
#X connect 8 0 9 0;
#X connect 9 0 10 0;
#X connect 10 0 21 0;
#X connect 10 1 21 1;
#X connect 11 0 12 0;
#X connect 11 0 22 0;
#X connect 12 0 18 0;
#X connect 16 0 17 1;
#X connect 16 0 19 1;
#X connect 17 0 13 0;
#X connect 18 0 17 0;
#X connect 19 0 14 0;
#X connect 20 0 19 0;
#X connect 21 0 3 0;
#X connect 22 0 20 0;
#X coords 0 -1 1 1 85 60 1 100 100;
#X restore 44 108 pd seek;
#N canvas 17 204 1265 643 aim 0;
#X obj 119 105 tgl 50 0 empty empty AIM 46 7 0 30 -262144 -1 -1 0 1
;
#X obj 114 77 sig2num~;
#X obj 114 55 r~ aim_mode;
#X obj 326 63 r ball_side;
#X obj 394 130 s~ aim_mode;
#X text 380 3 When to activate aim mode;
#X obj 481 60 r~ shoot_mode;
#X obj 481 82 not~;
#X obj 397 104 *~;
#X obj 326 85 sig~;
#X connect 1 0 0 0;
#X connect 2 0 1 0;
#X connect 3 0 9 0;
#X connect 6 0 7 0;
#X connect 7 0 8 1;
#X connect 8 0 4 0;
#X connect 9 0 8 0;
#X coords 0 -1 1 1 85 60 1 100 100;
#X restore 666 110 pd aim;
#N canvas 8 105 1265 660 shoot 0;
#X obj 119 105 tgl 50 0 empty empty SHOOT 46 7 0 30 -262144 -1 -1 0
1;
#X obj 114 77 sig2num~;
#X obj 114 54 r~ shoot_mode;
#X obj 289 80 r ball_side;
#X obj 388 78 r ball_near;
#X obj 500 77 r facing_goal;
#X obj 304 158 expr $f1 * $f2 * $f3;
#X obj 304 180 sig~;
#X obj 304 202 s~ shoot_mode;
#X obj 495 110 t b f;
#X obj 385 109 t b f;
#X text 325 33 When to activate shoot mode;
#X connect 1 0 0 0;
#X connect 2 0 1 0;
#X connect 3 0 6 0;
#X connect 4 0 10 0;
#X connect 5 0 9 0;
#X connect 6 0 7 0;
#X connect 7 0 8 0;
#X connect 9 0 6 0;
#X connect 9 1 6 2;
#X connect 10 0 6 0;
#X connect 10 1 6 1;
#X coords 0 -1 1 1 85 60 1 100 100;
#X restore 928 104 pd shoot;
#X obj 419 277 r ball_angle;
#X floatatom 419 299 5 0 0 0 - - -, f 5;
#X obj 775 272 r compass_heading;
#X floatatom 775 298 5 0 0 0 - - -, f 5;
#X obj 679 298 tgl 40 0 empty empty empty 17 7 0 10 -262144 -1 -1 0
1;
#X obj 286 275 r ball_detected;
#X obj 286 299 tgl 40 0 empty empty empty 17 7 0 10 -262144 -1 -1 1
1;
#X obj 544 272 r ball_distance;
#X obj 383 331 hsl 128 15 -180 180 0 0 empty empty empty -2 -8 0 10
-262144 -1 -1 5397 1;
#X obj 447 717 r way_is_clear;
#X obj 447 740 not;
#X obj 446 796 bang;
#X obj 430 942 throw~ throttle;
#X obj 447 821 delay 5000;
#X obj 555 800 r way_is_clear;
#X obj 348 822 delay 1000;
#X msg 354 857 0;
#X msg 558 846 stop;
#X obj 461 902 sig~;
#X msg 448 850 -0.75;
#X text 558 693 drive backwards if the robot is stuck for 5 seconds
, f 18;
#X obj 394 786 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144
-1 -1;
#X obj 314 822 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144
-1 -1;
#X obj 401 722 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144
-1 -1;
#X obj 447 762 change;
#N canvas 8 60 1265 628 round 1;
#X obj 119 105 tgl 50 0 empty empty ROUND 46 7 0 30 -262144 -1 -1 0
1;
#X obj 314 48 r ball_side;
#X obj 314 70 not;
#X obj 356 129 *;
#X obj 356 151 sig~;
#X obj 421 77 t b f;
#X obj 424 48 r ball_near;
#X obj 679 129 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144
-1 -1;
#X obj 677 64 sig2num~;
#X obj 677 87 change;
#X obj 677 109 moses 1;
#X obj 672 189 spigot;
#X obj 703 146 delay 50;
#X msg 707 167 0;
#X msg 869 274 1;
#X obj 674 349 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144
-1 -1;
#X obj 784 147 loadbang;
#X msg 784 169 1;
#X obj 356 170 s~ possible_round_mode;
#X msg 685 233 1;
#X obj 677 42 r~ possible_round_mode;
#X msg 703 337 0;
#X floatatom 634 215 5 0 0 0 - - -, f 5;
#X obj 634 236 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144
-1 -1;
#X obj 683 213 change;
#X obj 685 261 s round_mode;
#X obj 703 367 s round_mode;
#X obj 114 55 r round_mode;
#X obj 344 540 throw~ throttle;
#X obj 537 540 throw~ steering;
#X obj 469 314 r round_mode;
#X obj 350 497 sig~;
#X obj 529 506 sig~;
#X obj 918 353 r ball_angle;
#X obj 439 425 t b f;
#X obj 356 466 *;
#X obj 526 464 *;
#X obj 918 397 change;
#X obj 918 419 moses 1;
#X obj 918 442 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144
-1 -1;
#X obj 900 483 spigot;
#X obj 962 443 delay 10;
#X msg 962 465 0;
#X obj 903 529 s circle;
#X obj 1045 395 r round_mode;
#X obj 1045 417 change;
#X obj 1045 439 moses 1;
#X msg 1021 471 1;
#X obj 1055 488 s circle;
#X obj 879 511 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144
-1 -1;
#X obj 431 378 r circle;
#X floatatom 918 375 5 0 0 0 - - -, f 5;
#X msg 900 505 1;
#X obj 965 374 == 80;
#X obj 71 262 r round_mode;
#X obj 732 453 s circle;
#X obj 730 408 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144
-1 -1;
#X msg 730 428 0;
#X obj 1069 467 not;
#X obj 71 284 * -0.25;
#X obj 100 342 *;
#X obj 173 263 r circle;
#X obj 173 285 not;
#X obj 173 307 t b f;
#X obj 100 364 sig~;
#X obj 99 402 throw~ steering;
#X obj 431 400 * 0.8;
#X text 309 12 When the conditions are met to activate round mode,
f 33;
#X text 677 10 Only activate round mode once every 5 seconds, f 30
;
#X text 75 232 First turn to the left;
#X text 368 285 Secondly \, do a circle around the ball;
#X text 925 320 When to activate circle;
#X obj 666 314 delay 6000;
#X obj 355 441 * 1.15;
#X obj 526 442 * 0.85;
#X connect 1 0 2 0;
#X connect 2 0 3 0;
#X connect 3 0 4 0;
#X connect 4 0 18 0;
#X connect 5 0 3 0;
#X connect 5 1 3 1;
#X connect 6 0 5 0;
#X connect 7 0 11 0;
#X connect 7 0 12 0;
#X connect 8 0 9 0;
#X connect 9 0 10 0;
#X connect 10 1 7 0;
#X connect 11 0 22 0;
#X connect 11 0 23 0;
#X connect 11 0 24 0;
#X connect 11 0 72 0;
#X connect 12 0 13 0;
#X connect 13 0 11 1;
#X connect 14 0 11 1;
#X connect 16 0 17 0;
#X connect 17 0 11 1;
#X connect 19 0 25 0;
#X connect 20 0 8 0;
#X connect 21 0 26 0;
#X connect 24 0 19 0;
#X connect 27 0 0 0;
#X connect 30 0 73 0;
#X connect 30 0 74 0;
#X connect 31 0 28 0;
#X connect 32 0 29 0;
#X connect 33 0 51 0;
#X connect 33 0 53 0;
#X connect 34 0 35 0;
#X connect 34 0 36 0;
#X connect 34 1 35 1;
#X connect 34 1 36 1;
#X connect 35 0 31 0;
#X connect 36 0 32 0;
#X connect 37 0 38 0;
#X connect 38 1 39 0;
#X connect 39 0 41 0;
#X connect 39 0 40 0;
#X connect 40 0 49 0;
#X connect 40 0 52 0;
#X connect 41 0 42 0;
#X connect 42 0 40 1;
#X connect 44 0 45 0;
#X connect 45 0 46 0;
#X connect 46 0 47 0;
#X connect 46 0 48 0;
#X connect 46 1 58 0;
#X connect 46 1 47 0;
#X connect 47 0 40 1;
#X connect 50 0 66 0;
#X connect 52 0 43 0;
#X connect 53 0 37 0;
#X connect 54 0 59 0;
#X connect 56 0 57 0;
#X connect 57 0 55 0;
#X connect 58 0 48 0;
#X connect 59 0 60 0;
#X connect 60 0 64 0;
#X connect 61 0 62 0;
#X connect 62 0 63 0;
#X connect 63 0 60 0;
#X connect 63 1 60 1;
#X connect 64 0 65 0;
#X connect 66 0 34 0;
#X connect 72 0 14 0;
#X connect 72 0 15 0;
#X connect 72 0 21 0;
#X connect 73 0 35 0;
#X connect 74 0 36 0;
#X coords 0 -1 1 1 85 60 1 100 100;
#X restore 346 105 pd round;
#X text 28 18 Seek Mode: Active when the ball is NOT between us and
the goal \, and we are not close to the ball. Purpose is to get close
to the ball., f 29;
#X text 324 24 Round Mode: Active when the ball is NOT between us and
the goal and we are close to the ball. Purpose is to get the ball between
us and the target goal., f 38;
#X text 663 27 Aim Mode: Active when the ball is between us and the
target goal but we cannot see the goal or we are not close to the ball.
Purpose is to line up the ball up with the goal, f 35;
#X text 928 34 Shoot Mode: Active when ball is directly between the
robot and the goal. Purpose is to score!, f 30;
#X obj 916 271 r angle2goal;
#X obj 917 315 < 10;
#X obj 916 293 abs;
#X obj 956 295 tgl 50 0 empty empty facing_goal 17 7 0 10 -262144 -1
-1 0 1;
#X obj 916 351 s facing_goal;
#X obj 550 344 s ball_near;
#X obj 679 271 r ball_side;
#X obj 524 344 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 0
1;
#X floatatom 544 294 5 0 0 0 - - -, f 5;
#X obj 591 295 >= 130;
#X connect 1 0 0 2;
#X connect 3 0 0 0;
#X connect 7 0 8 0;
#X connect 8 0 15 0;
#X connect 9 0 10 0;
#X connect 12 0 13 0;
#X connect 14 0 45 0;
#X connect 14 0 46 0;
#X connect 16 0 17 0;
#X connect 17 0 31 0;
#X connect 18 0 20 0;
#X connect 18 0 30 0;
#X connect 20 0 26 0;
#X connect 20 0 22 0;
#X connect 20 0 28 0;
#X connect 21 0 24 0;
#X connect 22 0 23 0;
#X connect 22 0 29 0;
#X connect 23 0 25 0;
#X connect 24 0 20 0;
#X connect 24 0 22 0;
#X connect 25 0 19 0;
#X connect 26 0 25 0;
#X connect 31 0 18 0;
#X connect 37 0 39 0;
#X connect 38 0 40 0;
#X connect 38 0 41 0;
#X connect 39 0 38 0;
#X connect 43 0 11 0;
#X connect 46 0 42 0;
#X connect 46 0 44 0;
