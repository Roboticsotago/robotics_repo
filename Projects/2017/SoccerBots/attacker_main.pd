#N canvas 0 93 1920 987 10;
#X floatatom 102 68 5 0 0 0 - - -, f 5;
#X obj 105 91 hsl 64 15 -35 35 0 0 empty empty empty -2 -8 0 10 -262144
-1 -1 5452 1;
#X obj 691 105 tgl 50 0 empty empty ball_near 17 7 0 10 -262144 -1
-1 0 1;
#X obj 215 46 < 20;
#X obj 74 167 sig~;
#X obj 71 203 *~;
#X obj 70 304 throw~ steering;
#X obj 690 53 r ball_distance;
#X obj 217 67 tgl 50 0 empty empty facing_goal 17 7 0 10 -262144 -1
-1 0 1;
#X obj 856 54 r compass_heading;
#X obj 856 76 abs;
#X obj 856 98 < 70;
#N canvas 0 52 1280 722 differential_drive 0;
#X obj 309 193 vsl 15 100 -1 1 0 0 empty empty empty 0 -9 0 10 -262144
-1 -1 5940 1;
#X obj 390 187 vsl 15 100 -1 1 0 0 empty empty empty 0 -9 0 10 -262144
-1 -1 9900 1;
#X obj 314 140 +;
#X obj 390 140 +;
#X obj 314 162 clip -1 1;
#X obj 343 110 t b f;
#X obj 403 79 * -1;
#X obj 403 110 t b f;
#X obj 390 162 clip -1 1;
#X obj 251 340 s left_speed;
#X obj 398 343 s right_speed;
#X text 169 -144 forward/ backwards;
#X text 477 -146 left/right;
#X obj 616 -130 inlet;
#X text 563 -155 steering toggle;
#X obj 190 -119 inlet~;
#X obj 690 215 hsl 128 15 10 2000 0 0 empty empty empty -2 -8 0 10
-262144 -1 -1 64 1;
#X obj 487 -124 inlet~;
#X obj 643 173 loadbang;
#X msg 648 196 20;
#X obj 490 -67 *~;
#X obj 256 -121 inlet;
#X obj 190 -67 *~;
#X obj 204 116 tgl 50 1 steering_toggle_out steering_toggle_in empty
17 7 0 10 -262144 -1 -1 1 1;
#X obj 621 -75 s steering_toggle_in;
#X obj 617 -51 r steering_toggle_out;
#X obj 243 -99 s throttle_toggle_in;
#X obj 119 120 tgl 50 1 throttle_toggle_out throttle_toggle_in empty
17 7 0 10 -262144 -1 -1 1 1;
#X obj 242 -73 r throttle_toggle_out;
#X obj 201 228 hsl 60 15 -1 1 0 0 empty steering_drive empty -2 -8
0 10 -262144 -1 -1 885 1;
#X obj 137 205 vsl 15 60 -1 1 0 0 empty throttle_drive empty 0 -9 0
10 -262144 -1 -1 5605 1;
#X obj 190 46 s throttle_drive;
#X obj 491 48 s steering_drive;
#X floatatom 688 195 5 0 0 0 - - -, f 5;
#X obj 285 306 change;
#X obj 393 305 change;
#X obj 191 -43 lop~ 10;
#X obj 492 -44 lop~ 10;
#X obj 654 241 s sampling_period;
#X obj 254 -48 r sampling_period;
#X obj 610 -30 r sampling_period;
#X obj 194 -23 sig2num~;
#X obj 494 -20 sig2num~;
#X connect 0 0 34 0;
#X connect 1 0 35 0;
#X connect 2 0 4 0;
#X connect 3 0 8 0;
#X connect 4 0 0 0;
#X connect 5 0 2 0;
#X connect 5 1 2 1;
#X connect 6 0 7 0;
#X connect 7 0 3 0;
#X connect 7 1 3 1;
#X connect 8 0 1 0;
#X connect 13 0 24 0;
#X connect 15 0 22 0;
#X connect 16 0 33 0;
#X connect 16 0 38 0;
#X connect 17 0 20 0;
#X connect 18 0 19 0;
#X connect 19 0 16 0;
#X connect 20 0 37 0;
#X connect 21 0 26 0;
#X connect 22 0 36 0;
#X connect 25 0 20 1;
#X connect 28 0 22 1;
#X connect 34 0 9 0;
#X connect 35 0 10 0;
#X connect 36 0 41 0;
#X connect 37 0 42 0;
#X connect 39 0 41 1;
#X connect 40 0 42 1;
#X connect 41 0 31 0;
#X connect 41 0 2 0;
#X connect 41 0 3 0;
#X connect 42 0 32 0;
#X connect 42 0 6 0;
#X connect 42 0 5 0;
#X coords 0 -1 1 1 170 200 1 100 100;
#X restore 99 507 pd differential_drive;
#X obj 230 466 catch~ steering;
#X obj 850 120 tgl 50 0 empty empty facing_enemy_goal 17 7 0 10 -262144
-1 -1 0 1;
#N canvas 101 51 895 549 kick? 0;
#X obj 87 154 change;
#X obj 48 263 s kick;
#X obj 87 132 snapshot~;
#X obj 212 83 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 1
1;
#X obj 212 57 loadbang;
#X text 88 17 toggles kicker;
#X obj 212 107 metro 10;
#X obj 88 44 inlet~;
#X floatatom 154 153 5 0 0 0 - - -, f 5;
#X floatatom 147 179 5 0 0 0 - - -, f 5;
#X obj 88 77 lop~ 1;
#X obj 87 105 expr~ $v1 >= 0.5;
#X obj 48 207 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 0
1;
#X obj 48 185 metro 170;
#X obj 48 243 spigot;
#X obj 87 208 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 0
1;
#X obj 14 140 loadbang;
#X obj 48 164 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 1
1;
#X connect 0 0 9 0;
#X connect 0 0 15 0;
#X connect 2 0 0 0;
#X connect 2 0 8 0;
#X connect 3 0 6 0;
#X connect 4 0 3 0;
#X connect 6 0 2 0;
#X connect 7 0 10 0;
#X connect 10 0 11 0;
#X connect 11 0 2 0;
#X connect 12 0 14 0;
#X connect 13 0 12 0;
#X connect 14 0 1 0;
#X connect 15 0 14 1;
#X connect 16 0 17 0;
#X connect 17 0 13 0;
#X restore 1148 302 pd kick?;
#X obj 1799 51 r ball_detected;
#X obj 1037 51 r angle2goal;
#X obj 1586 53 r range;
#X obj 1040 77 abs;
#X obj 990 125 tgl 50 0 empty empty Facing_Goal 17 7 0 10 -262144 -1
-1 0 1;
#X obj 690 177 sig~;
#X obj 850 175 sig~;
#X obj 990 180 sig~;
#X text 1040 23 Vision:;
#X text 692 28 IR:;
#X text 71 15 IR:;
#X text 860 33 Compass:;
#X text 1802 25 IR:;
#X text 1589 25 Ultrasound:;
#N canvas 99 65 895 549 serial-connection 0;
#X obj 223 184 s motor_device;
#X text 216 68 Tell motor-control what serial device to use:;
#X obj 223 90 loadbang;
#X obj 223 112 delay 50;
#X msg 223 136 devicename /dev/serial/by-id/usb-DSpace__www.dspace.org.nz__DSpace_Robot_2.0_55234313335351503221-if00
;
#X obj 116 90 r reconnect;
#X obj 108 119 bng 15 250 50 0 empty empty Connect 17 7 0 10 -262144
-1 -1;
#X msg 128 190 close;
#X obj 108 140 bng 15 250 50 0 empty empty disconnect 17 7 0 10 -262144
-1 -1;
#X text 202 229 TODO: consider using the hostname message to set this.
Actually \, since the two robots will have different control patches
anyway \, this will work perfectly well.;
#X connect 2 0 3 0;
#X connect 3 0 4 0;
#X connect 4 0 0 0;
#X connect 5 0 6 0;
#X connect 6 0 4 0;
#X connect 7 0 0 0;
#X connect 8 0 7 0;
#X coords 0 -1 1 1 85 60 1 100 100;
#X restore 390 768 pd serial-connection;
#X obj 1149 51 r compass_heading;
#X obj 1291 52 r ball_angle;
#X obj 1151 94 * -1;
#X obj 1229 133 +;
#X obj 1274 74 t b f;
#X obj 1222 164 abs;
#X obj 1222 182 < 90;
#X obj 1283 122 tgl 50 0 empty empty ball_between_us_and_goal 17 7
0 10 -262144 -1 -1 0 1;
#X obj 1577 406 r angle2goal;
#X obj 1578 450 < 10;
#X obj 1577 428 abs;
#X obj 1619 430 tgl 50 0 empty empty facing_goal 17 7 0 10 -262144
-1 -1 0 1;
#X obj 1587 515 r ball_near;
#X text 99 5 controlling steering while shooting for the goal., f
29;
#X obj 1138 331 s~ shoot_mode;
#X obj 116 137 r~ shoot_mode;
#X obj 1222 204 sig~;
#X text 1165 11 Compass: detirmines whether the ball is between us
and the goal, f 30;
#X obj 1796 80 tgl 50 0 empty empty ball_detected 17 7 0 10 -262144
-1 -1 0 1;
#X obj 69 39 r angle2goal;
#X obj 72 138 / 35;
#N canvas 401 118 171 119 diy_pwm 0;
#X obj 18 59 outlet~;
#X obj 18 15 phasor~ 1;
#X obj 18 37 expr~ $v1 < 0.15;
#X connect 1 0 2 0;
#X connect 2 0 0 0;
#X restore 120 231 pd diy_pwm;
#X obj 72 230 *~;
#X obj 691 80 < 2;
#X obj 1138 274 expr~ $v1 * $v2 * $v3 * $v4 * $v5;
#X obj 1432 16 r ball_angle;
#X obj 1434 70 abs;
#X obj 1434 92 < 45;
#X obj 1467 121 tgl 50 0 empty empty facing_ball 17 7 0 10 -262144
-1 -1 1 1;
#X obj 1432 209 sig~;
#X obj 207 165 tgl 75 0 empty empty shoot_mode 17 7 0 10 -262144 -1
-1 0 1;
#X text 89 358 Seek mode:;
#X text 167 359 running: when not in shoot mode \, and when ball isn't
between robot and the goal., f 38;
#X obj 104 406 r~ shoot_mode;
#X obj 116 137 r~ shoot_mode;
#X obj 212 293 throw~ throttle;
#X floatatom 1587 78 5 0 0 0 - - -, f 5;
#X obj 1580 125 tgl 50 0 empty empty way_is_clear 17 7 0 10 -262144
-1 -1 1 1;
#X obj 282 246 r way_is_clear;
#X obj 1579 180 s way_is_clear;
#X obj 213 274 *~;
#X obj 89 466 catch~ throttle;
#X obj 1042 100 < 25;
#X obj 1583 98 expr $f1 == 0 || $f1 >= 16;
#X obj 72 252 *~ 1.2;
#X obj 1284 176 send ball_side;
#X obj 664 312 r ball_side;
#X text 667 293 Seek mode:;
#X obj 774 345 r~ shoot_mode;
#X obj 660 389 *~;
#X obj 663 335 sig~;
#X obj 774 367 expr~ $v1*-1+1;
#X obj 827 574 throw~ throttle;
#X obj 881 529 r way_is_clear;
#X obj 828 555 *~;
#X obj 711 477 metro;
#X obj 715 458 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 1
1;
#X obj 808 478 * 1000;
#X floatatom 807 459 5 0 0 0 - - -, f 5;
#X obj 805 416 loadbang;
#X floatatom 693 568 5 0 0 0 - - -, f 5;
#X obj 710 504 random 20;
#X obj 710 526 / 10;
#X obj 710 548 - 1;
#X obj 652 652 throw~ steering;
#X obj 662 415 s~ seek_mode;
#X obj 810 510 r~ seek_mode;
#X obj 616 543 r~ seek_mode;
#X obj 659 585 *~;
#X floatatom 217 122 5 0 0 0 - - -, f 5;
#X floatatom 1342 86 5 0 0 0 - - -, f 5;
#X obj 664 364 expr~ $v1*-1+1;
#X obj 711 585 r way_is_clear;
#X obj 653 611 *~;
#X floatatom 1204 82 5 0 0 0 - - -, f 5;
#X obj 711 607 * 0.8;
#X obj 711 629 + 0.2;
#X obj 828 533 *~ 0.9;
#X msg 807 434 4;
#X obj 708 436 loadbang;
#X floatatom 1460 46 5 0 0 0 - - -, f 5;
#X text 1135 386 Aim mode:;
#X obj 1137 408 r ball_side;
#X obj 1230 412 r~ shoot_mode;
#X obj 1138 455 *~;
#X obj 1136 431 sig~;
#X obj 1230 434 expr~ $v1*-1+1;
#X obj 1131 486 s~ aim_mode;
#X obj 366 145 tgl 50 0 empty empty SHOOT 17 7 0 20 -262144 -1 -1 0
1;
#X obj 363 65 sig2num~;
#X obj 476 144 tgl 50 0 empty empty SEEK 17 7 0 20 -262144 -1 -1 1
1;
#X obj 567 141 tgl 50 0 empty empty AIM 17 7 0 20 -262144 -1 -1 0 1
;
#X obj 1079 607 r~ aim_mode;
#X obj 1282 538 r ball_angle;
#X obj 1283 570 expr if(-45 < $f1 < 45 \, 1 \, 0);
#X obj 1142 684 throw~ throttle;
#X obj 1171 602 sig~;
#X obj 1285 595 expr if($f1 < -45 \, -1 \, 1);
#X obj 1273 628 sig~;
#X obj 1276 690 throw~ steering;
#X obj 1133 644 *~;
#X obj 1314 631 r~ aim_mode;
#X obj 1277 662 *~;
#X obj 213 252 *~ 0.25;
#X obj 363 34 r~ shoot_mode;
#X obj 467 33 r~ seek_mode;
#X obj 571 34 r~ aim_mode;
#X obj 116 163 sig2num~;
#X obj 613 455 sig2num~;
#X obj 521 667 sig2num~;
#X obj 467 66 sig2num~;
#X obj 567 62 sig2num~;
#X text 396 204 TODO: perhaps put each mode's control into a subpatch
\, with a graph-on-parent toggle to show whether it's active (and any
other info that might be handy)., f 46;
#X connect 0 0 1 0;
#X connect 2 0 21 0;
#X connect 3 0 8 0;
#X connect 4 0 5 0;
#X connect 5 0 53 0;
#X connect 7 0 54 0;
#X connect 8 0 100 0;
#X connect 9 0 10 0;
#X connect 10 0 11 0;
#X connect 11 0 14 0;
#X connect 13 0 12 2;
#X connect 14 0 22 0;
#X connect 16 0 49 0;
#X connect 17 0 19 0;
#X connect 18 0 67 0;
#X connect 19 0 73 0;
#X connect 20 0 23 0;
#X connect 21 0 55 0;
#X connect 22 0 55 1;
#X connect 23 0 55 2;
#X connect 31 0 33 0;
#X connect 31 0 105 0;
#X connect 32 0 35 0;
#X connect 32 0 101 0;
#X connect 33 0 34 0;
#X connect 34 0 36 0;
#X connect 35 0 34 0;
#X connect 35 1 34 1;
#X connect 36 0 37 0;
#X connect 37 0 38 0;
#X connect 37 0 47 0;
#X connect 38 0 76 0;
#X connect 39 0 41 0;
#X connect 40 0 42 0;
#X connect 41 0 40 0;
#X connect 46 0 5 1;
#X connect 46 0 134 0;
#X connect 46 0 138 0;
#X connect 47 0 55 3;
#X connect 50 0 3 0;
#X connect 50 0 51 0;
#X connect 50 0 0 0;
#X connect 51 0 4 0;
#X connect 52 0 53 1;
#X connect 53 0 75 0;
#X connect 54 0 2 0;
#X connect 55 0 15 0;
#X connect 55 0 45 0;
#X connect 56 0 111 0;
#X connect 56 0 57 0;
#X connect 57 0 58 0;
#X connect 58 0 59 0;
#X connect 58 0 60 0;
#X connect 60 0 55 4;
#X connect 67 0 74 0;
#X connect 68 0 70 0;
#X connect 69 0 71 1;
#X connect 71 0 66 0;
#X connect 72 0 12 0;
#X connect 73 0 20 0;
#X connect 74 0 68 0;
#X connect 75 0 6 0;
#X connect 77 0 81 0;
#X connect 79 0 82 0;
#X connect 80 0 96 0;
#X connect 80 0 139 0;
#X connect 81 0 102 0;
#X connect 82 0 80 1;
#X connect 84 0 85 1;
#X connect 85 0 83 0;
#X connect 86 0 92 0;
#X connect 87 0 86 0;
#X connect 88 0 86 1;
#X connect 89 0 88 0;
#X connect 90 0 109 0;
#X connect 91 0 99 1;
#X connect 92 0 93 0;
#X connect 93 0 94 0;
#X connect 94 0 91 0;
#X connect 97 0 108 0;
#X connect 98 0 99 0;
#X connect 99 0 104 0;
#X connect 102 0 80 0;
#X connect 103 0 106 0;
#X connect 104 0 95 0;
#X connect 104 0 140 0;
#X connect 106 0 107 0;
#X connect 107 0 104 1;
#X connect 108 0 85 0;
#X connect 109 0 89 0;
#X connect 110 0 87 0;
#X connect 113 0 116 0;
#X connect 114 0 117 0;
#X connect 115 0 118 0;
#X connect 116 0 115 0;
#X connect 117 0 115 1;
#X connect 120 0 119 0;
#X connect 123 0 131 0;
#X connect 124 0 125 0;
#X connect 125 0 127 0;
#X connect 125 0 128 0;
#X connect 127 0 131 1;
#X connect 128 0 129 0;
#X connect 129 0 133 0;
#X connect 131 0 126 0;
#X connect 132 0 133 1;
#X connect 133 0 130 0;
#X connect 134 0 71 0;
#X connect 135 0 120 0;
#X connect 136 0 141 0;
#X connect 137 0 142 0;
#X connect 138 0 61 0;
#X connect 141 0 121 0;
#X connect 142 0 122 0;
