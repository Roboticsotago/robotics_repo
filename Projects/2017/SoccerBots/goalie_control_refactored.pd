#N canvas 0 51 1265 722 10;
#X obj 765 53 r reflectance;
#X floatatom 765 75 5 0 0 0 - - -, f 5;
#X obj 765 94 > 800;
#X obj 765 117 tgl 30 0 empty empty inside_goal_zone 17 7 0 10 -262144
-1 -1 1 1;
#X obj 765 152 s inside_goal_zone;
#X obj 1048 53 r ball_detected;
#X obj 1048 75 tgl 30 0 empty empty ball_detected 17 7 0 10 -262144
-1 -1 0 1;
#X obj 1048 110 sig~;
#X obj 912 53 r ball_distance;
#X obj 912 75 moses 0.01;
#X obj 912 97 sig~;
#X obj 912 119 lop~ 1;
#X obj 912 141 s~ ball_distance~;
#X obj 1048 132 s~ ball_detected~;
#N canvas 442 201 781 476 panic 0;
#X obj 110 120 tgl 30 0 empty panic panic 17 7 0 10 -262144 -1 -1 0
1;
#X obj 637 199 r goal_detected;
#X obj 474 199 r inside_goal_zone;
#X obj 522 288 expr $f1 * $f2;
#X obj 474 221 not;
#X obj 637 221 not;
#X obj 637 243 t b f;
#X obj 361 399 s panic;
#X obj 522 311 moses 1;
#X msg 522 333 1;
#X obj 352 81 r return_home;
#X obj 352 103 moses 1;
#X obj 353 124 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144
-1 -1;
#X msg 352 251 1;
#X obj 277 82 r homed;
#X obj 277 103 moses 1;
#X msg 229 125 stop;
#X text 235 48 cancel panic when homed, f 12;
#X text 337 62 panic watchdog;
#X msg 275 126 0;
#X obj 361 273 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144
-1 -1;
#X obj 289 146 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144
-1 -1;
#X obj 352 186 spigot;
#X obj 430 166 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 1
1;
#X obj 458 135 loadbang;
#X obj 352 208 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144
-1 -1;
#X msg 407 137 0;
#X msg 310 126 1;
#X obj 352 229 delay 7500;
#X connect 1 0 5 0;
#X connect 2 0 4 0;
#X connect 3 0 8 0;
#X connect 4 0 3 0;
#X connect 5 0 6 0;
#X connect 6 0 3 0;
#X connect 6 1 3 1;
#X connect 8 1 9 0;
#X connect 9 0 7 0;
#X connect 10 0 11 0;
#X connect 12 0 22 0;
#X connect 13 0 7 0;
#X connect 13 0 20 0;
#X connect 13 0 23 0;
#X connect 14 0 15 0;
#X connect 15 0 12 0;
#X connect 15 1 16 0;
#X connect 15 1 19 0;
#X connect 15 1 27 0;
#X connect 16 0 28 0;
#X connect 19 0 7 0;
#X connect 19 0 21 0;
#X connect 22 0 25 0;
#X connect 23 0 22 1;
#X connect 24 0 23 0;
#X connect 25 0 26 0;
#X connect 25 0 28 0;
#X connect 26 0 23 0;
#X connect 27 0 23 0;
#X connect 28 0 13 0;
#X coords 0 -1 1 1 85 60 1 100 100;
#X restore 158 127 pd panic;
#X obj 50 51 loadbang;
#X floatatom 50 95 5 0 0 0 - - -, f 5;
#X text 49 28 States;
#X text 48 223 Modes;
#N canvas 401 185 724 483 rotate_2_ball 0;
#X obj 110 120 tgl 30 0 empty rotate_2_ball rotate_2_ball 17 7 0 10
-262144 -1 -1 1 1;
#X obj 281 55 r homed;
#X obj 280 285 s rotate_2_ball;
#X obj 362 55 r~ ball_distance~;
#X obj 362 77 sig2num~;
#X obj 362 165 t b f;
#X obj 491 55 inlet;
#X obj 362 99 <;
#X floatatom 491 77 5 0 0 0 - - -, f 5;
#X obj 362 143 not;
#X obj 281 216 *;
#X obj 537 55 r ball_detected;
#X obj 537 77 t b f;
#X obj 362 121 *;
#X obj 170 354 r ball_angle;
#X obj 283 352 r rotate_2_ball;
#X obj 170 400 sig~;
#X obj 283 374 sig~;
#X obj 170 422 *~;
#X obj 170 444 throw~ steering;
#N canvas 0 51 450 300 face_ball 0;
#X obj 29 168 clip -1 1;
#X obj 29 80 inlet;
#X obj 29 190 outlet;
#X obj 29 102 expr if($f1 > 20 \, $f1 - 20 \, if($f1 < -20 \, $f1 +
20 \, 0));
#X obj 29 124 / 160;
#X obj 29 146 * 2;
#X connect 0 0 2 0;
#X connect 1 0 3 0;
#X connect 3 0 4 0;
#X connect 4 0 5 0;
#X connect 5 0 0 0;
#X restore 170 376 pd face_ball;
#X text 422 346 TODO: could use rotate_2_ball while intercepting \,
check it intercepting to keep it on, f 25;
#X obj 281 238 moses 1;
#X msg 281 260 1;
#X obj 199 240 moses 1;
#X msg 199 262 0;
#X floatatom 125 379 5 0 0 0 - - -, f 5;
#X connect 1 0 10 0;
#X connect 1 0 24 0;
#X connect 3 0 4 0;
#X connect 4 0 7 0;
#X connect 5 0 10 0;
#X connect 5 1 10 1;
#X connect 6 0 7 1;
#X connect 6 0 8 0;
#X connect 7 0 13 0;
#X connect 9 0 5 0;
#X connect 10 0 22 0;
#X connect 11 0 12 0;
#X connect 12 0 13 0;
#X connect 12 1 13 1;
#X connect 13 0 9 0;
#X connect 14 0 20 0;
#X connect 14 0 26 0;
#X connect 15 0 17 0;
#X connect 16 0 18 0;
#X connect 17 0 18 1;
#X connect 18 0 19 0;
#X connect 20 0 16 0;
#X connect 22 1 23 0;
#X connect 23 0 2 0;
#X connect 24 0 25 0;
#X connect 25 0 2 0;
#X coords 0 -1 1 1 85 60 1 100 100;
#X restore 50 317 pd rotate_2_ball;
#N canvas 146 171 755 530 intercept_ball 0;
#X obj 110 120 tgl 30 0 empty intercept_ball intercept_ball 17 7 0
10 -262144 -1 -1 0 1;
#X obj 280 65 r homed;
#X obj 352 65 r~ ball_distance~;
#X obj 352 87 sig2num~;
#X obj 352 152 t b f;
#X obj 280 267 s intercept_ball;
#X obj 280 201 *;
#X obj 481 65 inlet;
#X obj 352 109 <;
#X floatatom 481 87 5 0 0 0 - - -, f 5;
#X obj 527 65 r ball_detected;
#X obj 352 131 *;
#X obj 527 87 t b f;
#X obj 196 344 loadbang;
#X msg 196 366 1;
#X floatatom 196 388 5 0 0 0 - - -, f 5;
#X obj 196 407 *~;
#X obj 280 343 r intercept_ball;
#X obj 280 365 sig~;
#X obj 196 429 throw~ throttle;
#N canvas 737 51 454 307 kick 0;
#X obj 258 141 change;
#X obj 78 228 s kick;
#X obj 258 119 snapshot~;
#X obj 383 70 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 1
1;
#X obj 383 44 loadbang;
#X text 234 6 toggles kicker;
#X obj 383 94 metro 10;
#X floatatom 325 140 5 0 0 0 - - -, f 5;
#X floatatom 318 166 5 0 0 0 - - -, f 5;
#X obj 258 92 expr~ $v1 >= 0.5;
#X obj 78 208 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 0
1;
#X obj 44 140 loadbang;
#X obj 78 164 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 0
1;
#X obj 259 31 inlet~;
#X obj 115 138 inlet;
#X obj 78 185 metro 170;
#X obj -21 186 r kick_toggle;
#X connect 2 0 0 0;
#X connect 2 0 7 0;
#X connect 3 0 6 0;
#X connect 4 0 3 0;
#X connect 6 0 2 0;
#X connect 9 0 2 0;
#X connect 10 0 1 0;
#X connect 11 0 12 0;
#X connect 12 0 15 0;
#X connect 13 0 9 0;
#X connect 14 0 12 0;
#X connect 15 0 10 0;
#X connect 16 0 10 0;
#X restore 314 429 pd kick;
#X obj 424 341 r ball_angle;
#N canvas 0 51 450 300 face_ball 0;
#X obj 29 168 clip -1 1;
#X obj 29 80 inlet;
#X obj 29 190 outlet;
#X obj 29 102 expr if($f1 > 20 \, $f1 - 20 \, if($f1 < -20 \, $f1 +
20 \, 0));
#X obj 29 124 / 160;
#X obj 29 146 * 2;
#X connect 0 0 2 0;
#X connect 1 0 3 0;
#X connect 3 0 4 0;
#X connect 4 0 5 0;
#X connect 5 0 0 0;
#X restore 424 364 pd face_ball;
#X floatatom 474 386 5 0 0 0 - - -, f 5;
#X obj 424 386 sig~;
#X obj 424 408 *~;
#X obj 424 432 throw~ steering;
#X obj 280 223 moses 1;
#X msg 280 245 1;
#X obj 206 225 moses 1;
#X msg 206 246 0;
#X text 518 362 Currently uses rotate_2_ball for steering, f 16;
#X connect 1 0 6 0;
#X connect 1 0 29 0;
#X connect 2 0 3 0;
#X connect 3 0 8 0;
#X connect 4 0 6 0;
#X connect 4 1 6 1;
#X connect 6 0 27 0;
#X connect 7 0 8 1;
#X connect 7 0 9 0;
#X connect 8 0 11 0;
#X connect 10 0 12 0;
#X connect 11 0 4 0;
#X connect 12 0 11 0;
#X connect 12 1 11 1;
#X connect 13 0 14 0;
#X connect 14 0 15 0;
#X connect 15 0 16 0;
#X connect 16 0 19 0;
#X connect 17 0 18 0;
#X connect 17 0 20 0;
#X connect 18 0 16 1;
#X connect 21 0 22 0;
#X connect 22 0 23 0;
#X connect 22 0 24 0;
#X connect 24 0 25 0;
#X connect 27 1 28 0;
#X connect 28 0 5 0;
#X connect 29 0 30 0;
#X connect 30 0 5 0;
#X coords 0 -1 1 1 85 60 1 100 100;
#X restore 193 317 pd intercept_ball;
#N canvas 334 156 1055 727 sig2num 0;
#X obj 86 74 snapshot~;
#X obj 82 42 inlet~;
#X floatatom 122 123 5 0 0 0 - - -, f 5;
#X obj 212 64 metro 250;
#X obj 198 15 loadbang;
#X obj 166 122 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 1
1;
#X connect 0 0 2 0;
#X connect 1 0 0 0;
#X connect 3 0 0 0;
#X connect 4 0 5 0;
#X connect 5 0 3 0;
#X coords 0 -1 1 1 85 60 1 100 100;
#X restore 950 168 pd sig2num;
#X text 75 73 range to goal;
#X obj 50 245 loadbang;
#X floatatom 50 289 5 0 0 0 - - -, f 5;
#X msg 50 267 0.7;
#X text 77 267 ir very close to ball;
#N canvas 450 192 928 505 return_home 0;
#X obj 110 120 tgl 30 0 empty return_home return_home 17 7 0 10 -262144
-1 -1 0 1;
#X obj 250 91 r homed;
#X obj 250 113 not;
#X obj 250 157 s return_home;
#X obj 101 189 r angle2goal;
#X obj 250 296 sig~;
#X floatatom 101 211 5 0 0 0 - - -, f 5;
#X obj 101 274 sig~;
#X obj 101 296 *~;
#X obj 101 252 *;
#X obj 167 220 t b f;
#X obj 101 318 throw~ steering;
#X obj 250 318 throw~ throttle;
#X obj 101 229 / 30;
#X obj 250 189 r return_home;
#N canvas 0 51 450 300 diy_pwm 0;
#X obj 18 59 outlet~;
#X obj 18 37 expr~ $v1 < 0.15;
#X obj 18 15 phasor~ 1;
#X connect 1 0 0 0;
#X connect 2 0 1 0;
#X restore 149 274 pd diy_pwm;
#X obj 250 274 * -0.25;
#X obj 316 68 r panic;
#X obj 250 135 *;
#X obj 316 113 t b f;
#X obj 316 90 not;
#X connect 1 0 2 0;
#X connect 2 0 18 0;
#X connect 2 0 3 0;
#X connect 4 0 6 0;
#X connect 5 0 12 0;
#X connect 6 0 13 0;
#X connect 7 0 8 0;
#X connect 8 0 11 0;
#X connect 9 0 7 0;
#X connect 10 0 9 0;
#X connect 10 1 9 1;
#X connect 13 0 9 0;
#X connect 14 0 10 0;
#X connect 14 0 16 0;
#X connect 15 0 8 1;
#X connect 16 0 5 0;
#X connect 17 0 20 0;
#X connect 19 0 18 0;
#X connect 19 1 18 1;
#X connect 20 0 19 0;
#X coords 0 -1 1 1 85 60 1 100 100;
#X restore 348 317 pd return_home;
#X obj 609 53 r range;
#X floatatom 609 76 5 0 0 0 - - -, f 5;
#X obj 609 96 moses 0;
#N canvas 0 51 1265 718 differential_drive 0;
#X obj 281 525 vsl 15 100 -1 1 0 0 empty empty empty 0 -9 0 10 -262144
-1 -1 4950 1;
#X obj 362 519 vsl 15 100 -1 1 0 0 empty empty empty 0 -9 0 10 -262144
-1 -1 4950 1;
#X obj 345 194 vsl 15 100 -1 1 0 0 empty empty empty 0 -9 0 10 -262144
-1 -1 4950 1;
#X obj 304 352 hsl 100 15 -1 1 0 0 empty empty empty -2 -8 0 10 -262144
-1 -1 4950 1;
#X obj 256 472 +;
#X obj 362 472 +;
#X floatatom 344 326 5 0 0 0 - - -, f 5;
#X obj 284 442 t b f;
#X obj 375 411 * -1;
#X obj 375 442 t b f;
#X floatatom 246 384 5 0 0 0 - - -, f 5;
#X obj 220 686 s left_speed;
#X obj 370 684 s right_speed;
#X text -7 20 forward/ backwards;
#X text 874 19 left/right;
#X obj 963 117 inlet;
#X text 910 92 steering toggle;
#X obj 379 101 sig2num~;
#X obj 26 46 inlet~;
#X obj 553 150 sig2num~;
#X obj 459 25 hsl 128 15 10 2000 0 0 empty empty empty -2 -8 0 10 -262144
-1 -1 64 1;
#X obj 842 49 inlet~;
#X obj 291 9 loadbang;
#X msg 296 32 20;
#X obj 704 117 *~;
#X obj 205 10 inlet;
#X obj 133 74 *~;
#X obj 204 116 tgl 50 1 steering_toggle_out steering_toggle_in empty
17 7 0 10 -262144 -1 -1 1 1;
#X obj 963 139 s steering_toggle_in;
#X obj 966 186 r steering_toggle_out;
#X obj 142 30 s throttle_toggle_in;
#X obj 119 120 tgl 50 1 throttle_toggle_out throttle_toggle_in empty
17 7 0 10 -262144 -1 -1 1 1;
#X obj 182 55 r throttle_toggle_out;
#X obj 201 228 hsl 60 15 -1 1 0 0 empty steering_drive empty -2 -8
0 10 -262144 -1 -1 2950 1;
#X obj 137 205 vsl 15 60 -1 1 0 0 empty throttle_drive empty 0 -9 0
10 -262144 -1 -1 2950 1;
#X obj 398 197 s throttle_drive;
#X obj 574 278 s steering_drive;
#X floatatom 471 73 5 0 0 0 - - -, f 5;
#X text 0 94 TODO: enable these at startup:;
#X obj 256 494 clip -0.8 0.8;
#X obj 362 494 clip -0.8 0.8;
#X connect 0 0 11 0;
#X connect 1 0 12 0;
#X connect 2 0 6 0;
#X connect 3 0 7 0;
#X connect 3 0 8 0;
#X connect 3 0 10 0;
#X connect 4 0 39 0;
#X connect 5 0 40 0;
#X connect 6 0 4 0;
#X connect 6 0 5 0;
#X connect 7 0 4 0;
#X connect 7 1 4 1;
#X connect 8 0 9 0;
#X connect 9 0 5 0;
#X connect 9 1 5 1;
#X connect 15 0 28 0;
#X connect 17 0 2 0;
#X connect 17 0 35 0;
#X connect 18 0 26 0;
#X connect 19 0 3 0;
#X connect 19 0 36 0;
#X connect 20 0 17 1;
#X connect 20 0 19 1;
#X connect 20 0 37 0;
#X connect 21 0 24 0;
#X connect 22 0 23 0;
#X connect 23 0 20 0;
#X connect 24 0 19 0;
#X connect 25 0 30 0;
#X connect 26 0 17 0;
#X connect 29 0 24 1;
#X connect 32 0 26 1;
#X connect 39 0 0 0;
#X connect 40 0 1 0;
#X coords 0 -1 1 1 170 200 1 100 100;
#X restore 654 485 pd differential_drive;
#X obj 655 142 tgl 30 0 empty empty way_is_clear 17 7 0 10 -262144
-1 -1 1 1;
#X msg 701 431 -1;
#X msg 655 430 0;
#X obj 655 403 moses 1;
#X obj 655 458 clip~ 0 1;
#X obj 762 458 catch~ steering;
#X obj 536 402 catch~ throttle;
#X obj 655 120 >;
#N canvas 63 267 864 411 homed 0;
#X obj 552 32 r range;
#X obj 278 32 r inside_goal_zone;
#X obj 681 32 r compass_heading;
#X obj 387 161 expr $f1 * $f2 * $f3 * $f4;
#X obj 110 120 tgl 30 0 empty homed homed 17 7 0 10 -262144 -1 -1 1
1;
#X obj 387 183 moses 1;
#X msg 387 205 1;
#X obj 387 252 s homed;
#X obj 278 128 moses 1;
#X msg 308 205 0;
#X obj 425 32 r goal_detected;
#X obj 425 54 t b f;
#X obj 598 97 t b f;
#X obj 681 98 t b f;
#X obj 598 75 <;
#X obj 616 32 inlet;
#X floatatom 616 54 5 0 0 0 - - -, f 5;
#X floatatom 761 54 5 0 0 0 - - -, f 5;
#X obj 681 54 abs;
#X obj 552 54 moses 1;
#X obj 681 76 < 90;
#X text 156 181 allow boris to keep intercepting the ball once past
the goal zone, f 17;
#X msg 449 228 0;
#X obj 289 206 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144
-1 -1;
#X obj 278 150 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144
-1 -1;
#X obj 278 106 change;
#X obj 308 183 delay 500;
#X obj 449 252 s kick_toggle;
#X connect 0 0 19 0;
#X connect 1 0 3 0;
#X connect 1 0 25 0;
#X connect 2 0 17 0;
#X connect 2 0 18 0;
#X connect 3 0 5 0;
#X connect 5 1 6 0;
#X connect 6 0 7 0;
#X connect 6 0 22 0;
#X connect 8 0 24 0;
#X connect 9 0 7 0;
#X connect 10 0 11 0;
#X connect 11 0 3 0;
#X connect 11 1 3 1;
#X connect 12 0 3 0;
#X connect 12 1 3 2;
#X connect 13 0 3 0;
#X connect 13 1 3 3;
#X connect 14 0 12 0;
#X connect 15 0 16 0;
#X connect 16 0 14 1;
#X connect 18 0 20 0;
#X connect 19 1 14 0;
#X connect 20 0 13 0;
#X connect 22 0 27 0;
#X connect 24 0 26 0;
#X connect 25 0 8 0;
#X connect 26 0 9 0;
#X connect 26 0 23 0;
#X coords 0 -1 1 1 85 60 1 100 100;
#X restore 50 127 pd homed;
#N canvas 90 51 895 345 motor-serial 0;
#X text 69 49 Tell motor-control what serial device to use:;
#X obj 76 244 s motor_device;
#X obj 12 142 loadbang;
#X obj 12 164 delay 50;
#X obj 103 104 bng 50 250 50 0 empty empty restart 17 7 0 10 -262144
-1 -1;
#X obj 102 74 r dspace_restart;
#X msg 73 192 devicename /dev/serial/by-id/usb-DSpace__www.dspace.org.nz__DSpace_Robot_2.0_55234313335351A0D161-if00
, f 111;
#X obj 165 131 bng 15 250 50 0 empty empty disconnect 17 7 0 10 -262144
-1 -1;
#X msg 165 151 close;
#X obj 244 74 inlet;
#X connect 2 0 3 0;
#X connect 3 0 6 0;
#X connect 4 0 6 0;
#X connect 5 0 4 0;
#X connect 6 0 1 0;
#X connect 7 0 8 0;
#X connect 8 0 1 0;
#X connect 9 0 4 0;
#X coords 0 -1 1 1 85 60 1 100 100;
#X restore 1023 434 pd motor-serial;
#X text 271 138 TODO: create a method to undertake given the panic
state, f 19;
#X obj 1023 407 metro;
#X msg 973 376 1;
#X msg 1007 376 0;
#X floatatom 1055 356 5 0 0 0 - - -, f 5;
#X obj 1055 375 * 1000;
#X obj 1055 311 loadbang;
#X text 918 309 Reconnect every n seconds to prevent total loss of
function, f 19;
#X floatatom 728 336 5 0 0 0 - - -, f 5;
#X obj 728 314 r ball_angle;
#X msg 50 73 20;
#X msg 1055 333 60;
#N canvas 489 270 562 348 reorientate 1;
#X obj 110 120 tgl 30 0 empty reorientate reorientate 17 7 0 10 -262144
-1 -1 0 1;
#X obj 242 71 r panic;
#X obj 242 93 s reorientate;
#X obj 242 131 r reorientate;
#X connect 1 0 2 0;
#X coords 0 -1 1 1 85 60 1 100 100;
#X restore 50 404 pd reorientate;
#X obj 820 240 r bal_angle;
#X floatatom 820 262 5 0 0 0 - - -, f 5;
#X connect 0 0 1 0;
#X connect 1 0 2 0;
#X connect 2 0 3 0;
#X connect 3 0 4 0;
#X connect 5 0 6 0;
#X connect 6 0 7 0;
#X connect 7 0 13 0;
#X connect 8 0 9 0;
#X connect 9 1 10 0;
#X connect 10 0 11 0;
#X connect 11 0 12 0;
#X connect 11 0 21 0;
#X connect 15 0 52 0;
#X connect 16 0 39 0;
#X connect 16 0 40 0;
#X connect 23 0 25 0;
#X connect 24 0 20 0;
#X connect 24 0 19 0;
#X connect 25 0 24 0;
#X connect 28 0 29 0;
#X connect 29 0 30 0;
#X connect 30 1 39 0;
#X connect 32 0 35 0;
#X connect 33 0 36 1;
#X connect 34 0 36 1;
#X connect 35 0 34 0;
#X connect 35 1 33 0;
#X connect 36 0 31 0;
#X connect 37 0 31 2;
#X connect 38 0 36 0;
#X connect 39 0 32 0;
#X connect 44 0 43 0;
#X connect 45 0 43 0;
#X connect 46 0 47 0;
#X connect 47 0 43 1;
#X connect 48 0 53 0;
#X connect 48 0 44 0;
#X connect 51 0 50 0;
#X connect 52 0 16 0;
#X connect 53 0 46 0;
#X connect 55 0 56 0;
