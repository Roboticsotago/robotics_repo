#N canvas 3 49 1194 1520 10;
#X floatatom 524 264 8 0 0 0 - - -, f 8;
#X obj 517 218 osc~;
#X floatatom 193 179 8 0 127 0 Target - -, f 8;
#X text 19 31 Pitch-tracking feedback for CelloBot..?;
#X obj 141 866 -~;
#X floatatom 173 909 8 0 0 0 Kp - -, f 8;
#X obj 173 928 sig~;
#X obj 139 958 *~;
#X obj 173 863 loadbang;
#X text 144 820 P;
#X obj 481 1399 +~;
#X text 511 1400 <- Combine P \, I \, and D components;
#X obj 441 1293 tgl 15 0 empty empty P 17 7 0 10 -262144 -1 -1 1 1
;
#X obj 423 1315 *~;
#X obj 491 1293 tgl 15 0 empty empty I 17 7 0 10 -262144 -1 -1 1 1
;
#X obj 473 1315 *~;
#X obj 541 1293 tgl 15 0 empty empty D 17 7 0 10 -262144 -1 -1 1 1
;
#X obj 523 1315 *~;
#X obj 299 1389 slider~;
#X obj 209 1389 slider~;
#X obj 389 1389 slider~;
#X obj 890 998 loadbang;
#X floatatom 890 1042 8 0 0 0 Kd - -, f 8;
#X obj 890 1061 sig~;
#X obj 858 1085 *~;
#X obj 860 915 -~;
#X obj 859 939 fexpr~ $x1 - $y[-1];
#X text 938 896 D:;
#X obj 482 1442 delwrite~ cello-control 500;
#X obj 628 103 slider~;
#X obj 520 66 delread~ cello-control;
#X obj 193 198 + 0.5;
#X obj 193 220 i;
#X floatatom 193 242 5 0 0 0 - - -, f 5;
#X obj 193 261 sig~;
#X obj 571 308 sig~;
#X obj 785 545 slider~;
#X text 773 480 Anti-windup (actuator-not-saturated check):;
#X obj 260 363 dac~;
#X text 702 294 Note that sigmund~ doesn't work below a certain threshold
\, based on analysis window size., f 25;
#X obj 588 281 max 50;
#X obj 260 283 osc~;
#X obj 519 154 *~ 6000;
#X obj 260 260 mtof;
#X text 570 189 <- lag;
#X msg 77 112 60;
#X obj 706 204 slider~;
#X msg 107 112 62;
#X msg 137 112 64;
#X msg 167 112 65;
#X msg 197 112 67;
#X msg 227 112 69;
#X msg 258 112 71;
#X msg 287 112 72;
#X floatatom 238 242 8 0 0 0 - - -, f 8;
#X obj 786 175 slider~;
#X msg 173 885 0.0001;
#X obj 518 279 moses 30;
#X msg 890 1020 0.0001;
#X obj 336 20 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 0
1;
#X obj 336 40 moses 1;
#X msg 332 61 0;
#X obj 332 83 pack f 20;
#X obj 332 105 line~;
#X obj 285 332 *~;
#X msg 376 61 0.2;
#X obj 260 305 *~;
#X obj 42 901 slider~;
#X obj 14 60 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144 -1
-1;
#X obj 14 80 random 64;
#X obj 14 102 + 32;
#X text 778 659 Problem is it can get stuck when the anti-windup kicks
in. Maybe moving average integral would be better...;
#X obj 789 705 tgl 15 0 empty empty Anti-windup_enable 17 7 0 10 -262144
-1 -1 1 1;
#X obj 771 727 *~;
#X floatatom 1148 925 8 0 0 0 alpha - -, f 8;
#X obj 858 968 fexpr~ $y1[-1] + $x2[0] * ($x1[0]-$y1[-1]);
#X obj 1148 944 sig~;
#X obj 1148 882 loadbang;
#X text 946 949 Exponential weighted avg:;
#N canvas 3 49 1194 1520 D_alt 0;
#X obj 115 136 loadbang;
#X floatatom 115 180 8 0 0 0 Ki - -, f 8;
#X obj 115 199 sig~;
#X obj 83 223 *~;
#X obj 85 83 -~;
#X obj 84 107 fexpr~ $x1 - $y[-1];
#X floatatom 177 210 5 0 0 0 - - -, f 5;
#X obj 177 229 expr 1/$f1;
#X floatatom 177 251 5 0 0 0 - - -, f 5;
#X obj 82 257 lop~;
#X obj 190 166 loadbang;
#X msg 123 229 clear;
#X msg 190 188 10;
#X msg 115 158 0.0001;
#X obj 74 33 inlet~;
#X obj 147 39 inlet~;
#X obj 71 297 outlet~;
#X connect 0 0 13 0;
#X connect 1 0 2 0;
#X connect 2 0 3 1;
#X connect 3 0 9 0;
#X connect 4 0 5 0;
#X connect 5 0 3 0;
#X connect 6 0 7 0;
#X connect 7 0 8 0;
#X connect 8 0 9 1;
#X connect 9 0 16 0;
#X connect 10 0 12 0;
#X connect 11 0 9 0;
#X connect 12 0 6 0;
#X connect 13 0 1 0;
#X connect 14 0 4 0;
#X connect 15 0 4 1;
#X restore 993 894 pd D_alt;
#X msg 1148 904 0.001;
#X obj 518 246 sigmund~ -hop 2048 pitch;
#N canvas 3 49 1194 1520 Integral 0;
#X obj -28 -486 inlet~;
#X obj 39 -485 inlet~;
#X text -35 -507 Reference;
#X text 38 -505 Current;
#X text 422 -512 Anti-Windup;
#X obj 422 -492 inlet~;
#X obj 7 -421 -~;
#X obj 122 91 loadbang;
#X floatatom 122 175 8 0 0 0 Ki - -, f 8;
#X obj 122 194 sig~;
#X obj 83 217 *~;
#X floatatom 122 135 5 0 0 0 - - -, f 5;
#X obj 122 154 / 1e+06;
#X obj 46 -25 *~ 1e+07;
#X obj 46 25 *~ 1e-07;
#X obj -144 5 fexpr~ $y1[-1] + $x1[0];
#X obj 125 -233 *~;
#X msg 307 -101 clear;
#X obj -133 273 slider~;
#X msg 122 113 0.5;
#X floatatom 601 -38 8 0 0 0 alpha - -, f 8;
#X obj 303 2 fexpr~ $y1[-1] + $x2[0] * ($x1[0]-$y1[-1]);
#X obj 601 -19 sig~;
#X obj 596 -81 loadbang;
#X text 390 -19 Exponential weighted avg:;
#X obj -61 -377 slider~;
#X text 157 -234 <- anti-windup;
#X obj 430 -444 sig~ 1;
#X msg 596 -59 0.0001;
#X obj 448 -419 tgl 15 0 empty empty Constant 17 7 0 10 -262144 -1
-1 0 1;
#X obj 430 -397 *~;
#X obj 46 1 fexpr~ $y1[-1] + $x1[0];
#X obj -107 217 -~;
#X text 46 -415 <- error;
#X obj 68 301 outlet~;
#X obj 153 241 slider~;
#X connect 0 0 6 0;
#X connect 1 0 6 1;
#X connect 5 0 16 1;
#X connect 6 0 16 0;
#X connect 6 0 25 0;
#X connect 7 0 19 0;
#X connect 8 0 9 0;
#X connect 9 0 10 1;
#X connect 10 0 34 0;
#X connect 10 0 35 0;
#X connect 11 0 12 0;
#X connect 12 0 8 0;
#X connect 13 0 21 0;
#X connect 13 0 31 0;
#X connect 14 0 10 0;
#X connect 14 0 32 1;
#X connect 15 0 10 0;
#X connect 15 0 32 0;
#X connect 16 0 13 0;
#X connect 16 0 15 0;
#X connect 17 0 15 0;
#X connect 17 0 21 0;
#X connect 17 0 31 0;
#X connect 19 0 11 0;
#X connect 20 0 22 0;
#X connect 22 0 21 1;
#X connect 23 0 28 0;
#X connect 27 0 30 0;
#X connect 28 0 20 0;
#X connect 29 0 30 1;
#X connect 30 0 16 1;
#X connect 31 0 14 0;
#X connect 32 0 18 0;
#X coords 0 -1 1 1 123 96 1 100 100;
#X restore 477 962 pd Integral;
#X obj 520 110 clip~ 0.01 1;
#X text 474 364 NOTE: limits to tracking range due to sigmund analysis
size and the clipping above.;
#X obj 770 506 expr~ !($v1 <= 0 || $v1 >= 1);
#X obj 866 1151 slider~;
#X obj 517 186 lop~ 10;
#X connect 1 0 64 0;
#X connect 1 0 81 0;
#X connect 2 0 31 0;
#X connect 4 0 7 0;
#X connect 4 0 67 0;
#X connect 5 0 6 0;
#X connect 6 0 7 1;
#X connect 7 0 13 0;
#X connect 8 0 56 0;
#X connect 10 0 28 0;
#X connect 12 0 13 1;
#X connect 13 0 10 0;
#X connect 13 0 19 0;
#X connect 14 0 15 1;
#X connect 15 0 10 0;
#X connect 15 0 18 0;
#X connect 16 0 17 1;
#X connect 17 0 10 0;
#X connect 17 0 20 0;
#X connect 21 0 58 0;
#X connect 22 0 23 0;
#X connect 23 0 24 1;
#X connect 24 0 17 0;
#X connect 24 0 86 0;
#X connect 25 0 26 0;
#X connect 26 0 75 0;
#X connect 30 0 29 0;
#X connect 30 0 83 0;
#X connect 31 0 32 0;
#X connect 32 0 33 0;
#X connect 33 0 34 0;
#X connect 33 0 43 0;
#X connect 34 0 4 0;
#X connect 34 0 25 0;
#X connect 34 0 82 0;
#X connect 35 0 4 1;
#X connect 35 0 25 1;
#X connect 35 0 82 1;
#X connect 41 0 66 0;
#X connect 42 0 55 0;
#X connect 42 0 87 0;
#X connect 43 0 41 0;
#X connect 45 0 2 0;
#X connect 47 0 2 0;
#X connect 48 0 2 0;
#X connect 49 0 2 0;
#X connect 50 0 2 0;
#X connect 51 0 2 0;
#X connect 52 0 2 0;
#X connect 53 0 2 0;
#X connect 56 0 5 0;
#X connect 57 1 54 0;
#X connect 57 1 35 0;
#X connect 58 0 22 0;
#X connect 59 0 60 0;
#X connect 60 0 61 0;
#X connect 60 1 65 0;
#X connect 61 0 62 0;
#X connect 62 0 63 0;
#X connect 63 0 64 1;
#X connect 63 0 66 1;
#X connect 64 0 38 1;
#X connect 65 0 62 0;
#X connect 66 0 38 0;
#X connect 68 0 69 0;
#X connect 69 0 70 0;
#X connect 70 0 2 0;
#X connect 72 0 73 1;
#X connect 73 0 82 2;
#X connect 74 0 76 0;
#X connect 75 0 24 0;
#X connect 76 0 75 1;
#X connect 77 0 80 0;
#X connect 80 0 74 0;
#X connect 81 0 0 0;
#X connect 81 0 57 0;
#X connect 82 0 15 0;
#X connect 83 0 42 0;
#X connect 83 0 85 0;
#X connect 85 0 36 0;
#X connect 85 0 73 0;
#X connect 87 0 1 0;
#X connect 87 0 46 0;
